{
  "properties": {
    "displayName": "Deploy SQL Database built-in SQL security configuration",
    "policyType": "Custom",
    "description": "Deploy auditing, Alert, TDE and SQL vulnerability to SQL Databases when it not exist in the deployment",
    "metadata": {
      "alzCloudEnvironments": [
        "AzureCloud",
        "AzureChinaCloud",
        "AzureUSGovernment"
      ],
      "category": "SQL",
      "replacesPolicy": "Deploy-Sql-Security",
      "source": "https://github.com/Azure/Enterprise-Scale/",
      "version": "1.1.0",
      "createdBy": "bbd0bbbd-16fc-4c39-a530-65ced78b7590",
      "createdOn": "2026-01-21T00:37:17.3145311Z",
      "updatedBy": null,
      "updatedOn": null
    },
    "parameters": {
      "SqlDbAuditingSettingsDeploySqlSecurityEffect": {
        "type": "String",
        "metadata": {
          "description": "Deploy auditing settings to SQL Database when it not exist in the deployment",
          "displayName": "Deploy SQL database auditing settings"
        },
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists"
      },
      "SqlDbSecurityAlertPoliciesDeploySqlSecurityEffect": {
        "type": "String",
        "metadata": {
          "description": "Deploy the security Alert Policies configuration with email admin accounts when it not exist in current configuration",
          "displayName": "Deploy SQL Database security Alert Policies configuration with email admin accounts"
        },
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists"
      },
      "SqlDbTdeDeploySqlSecurityEffect": {
        "type": "String",
        "metadata": {
          "description": "Deploy the Transparent Data Encryption when it is not enabled in the deployment",
          "displayName": "Deploy SQL Database Transparent Data Encryption "
        },
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists"
      },
      "SqlDbVulnerabilityAssessmentsDeploySqlSecurityEffect": {
        "type": "String",
        "metadata": {
          "description": "Deploy SQL Database vulnerability Assessments when it not exist in the deployment. To the specific  storage account in the parameters",
          "displayName": "Deploy SQL Database vulnerability Assessments"
        },
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists"
      },
      "vulnerabilityAssessmentsEmail": {
        "type": "Array",
        "metadata": {
          "description": "The email address to send alerts",
          "displayName": "The email address to send alerts"
        }
      },
      "vulnerabilityAssessmentsStorageID": {
        "type": "String",
        "metadata": {
          "description": "The storage account ID to store assessments",
          "displayName": "The storage account ID to store assessments"
        }
      }
    },
    "policyDefinitions": [
      {
        "policyDefinitionReferenceId": "SqlDbTdeDeploySqlSecurity",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/86a912f6-9a06-4e26-b447-11b16ba8659f",
        "parameters": {
          "effect": {
            "value": "[parameters('SqlDbTdeDeploySqlSecurityEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "SqlDbSecurityAlertPoliciesDeploySqlSecurity",
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/alz/providers/Microsoft.Authorization/policyDefinitions/Deploy-Sql-SecurityAlertPolicies",
        "parameters": {
          "effect": {
            "value": "[parameters('SqlDbSecurityAlertPoliciesDeploySqlSecurityEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "SqlDbAuditingSettingsDeploySqlSecurity",
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/alz/providers/Microsoft.Authorization/policyDefinitions/Deploy-Sql-AuditingSettings",
        "parameters": {
          "effect": {
            "value": "[parameters('SqlDbAuditingSettingsDeploySqlSecurityEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "SqlDbVulnerabilityAssessmentsDeploySqlSecurity",
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/alz/providers/Microsoft.Authorization/policyDefinitions/Deploy-Sql-vulnerabilityAssessments_20230706",
        "parameters": {
          "effect": {
            "value": "[parameters('SqlDbVulnerabilityAssessmentsDeploySqlSecurityEffect')]"
          },
          "vulnerabilityAssessmentsEmail": {
            "value": "[parameters('vulnerabilityAssessmentsEmail')]"
          },
          "vulnerabilityAssessmentsStorageID": {
            "value": "[parameters('vulnerabilityAssessmentsStorageID')]"
          }
        },
        "groupNames": []
      }
    ],
    "policyDefinitionGroups": []
  },
  "id": "/providers/Microsoft.Management/managementGroups/alz/providers/Microsoft.Authorization/policySetDefinitions/Deploy-Sql-Security_20240529",
  "type": "Microsoft.Authorization/policySetDefinitions",
  "name": "Deploy-Sql-Security_20240529",
  "systemData": {
    "createdBy": "2fb557e8-a7b2-4828-b19d-b2ddee966115",
    "createdByType": "Application",
    "createdAt": "2026-01-21T00:37:17.227158Z",
    "lastModifiedBy": "2fb557e8-a7b2-4828-b19d-b2ddee966115",
    "lastModifiedByType": "Application",
    "lastModifiedAt": "2026-01-21T00:37:17.227158Z"
  }
}
