{
  "displayName": "[Deprecated]: Configure SQL VM and Arc-enabled SQL Servers to install Microsoft Defender for SQL and AMA with a user-defined LAW",
  "policyType": "Custom",
  "description": "Initiative is deprecated as the built-in initiative now supports bringing your own UAMI and DCR. Superseded by https://www.azadvertizer.net/azpolicyinitiativesadvertizer/de01d381-bae9-4670-8870-786f89f49e26.html",
  "metadata": {
    "alzCloudEnvironments": [
      "AzureCloud"
    ],
    "category": "Security Center",
    "deprecated": true,
    "source": "https://github.com/Azure/Enterprise-Scale/",
    "supersededBy": "de01d381-bae9-4670-8870-786f89f49e26",
    "version": "1.0.1-deprecated",
    "createdBy": "bbd0bbbd-16fc-4c39-a530-65ced78b7590",
    "createdOn": "2026-01-21T00:37:17.3243439Z",
    "updatedBy": null,
    "updatedOn": null
  },
  "parameters": {
    "dcrId": {
      "type": "String",
      "metadata": {
        "description": "Id of the Data Collection Rule.",
        "displayName": "Data Collection Rule Id"
      }
    },
    "dcrName": {
      "type": "String",
      "metadata": {
        "description": "Name of the Data Collection Rule.",
        "displayName": "Data Collection Rule Name"
      }
    },
    "dcrResourceGroup": {
      "type": "String",
      "metadata": {
        "description": "Resource Group of the Data Collection Rule.",
        "displayName": "Data Collection Rule Resource Group"
      }
    },
    "effect": {
      "type": "String",
      "metadata": {
        "description": "Enable or disable the execution of the policy",
        "displayName": "Effect"
      },
      "allowedValues": [
        "DeployIfNotExists",
        "Disabled"
      ],
      "defaultValue": "DeployIfNotExists"
    },
    "enableCollectionOfSqlQueriesForSecurityResearch": {
      "type": "Boolean",
      "metadata": {
        "description": "Enable or disable the collection of SQL queries for security research.",
        "displayName": "Enable collection of SQL queries for security research"
      },
      "allowedValues": [
        true,
        false
      ],
      "defaultValue": false
    },
    "identityResourceGroup": {
      "type": "String",
      "metadata": {
        "description": "The name of the resource group created by the policy.",
        "displayName": "Identity Resource Group"
      },
      "defaultValue": ""
    },
    "userAssignedIdentityName": {
      "type": "String",
      "metadata": {
        "description": "The name of the user assigned managed identity.",
        "displayName": "User Assigned Managed Identity Name"
      },
      "defaultValue": ""
    },
    "userWorkspaceResourceId": {
      "type": "String",
      "metadata": {
        "description": "Workspace resource Id of the Log Analytics workspace destination for the Data Collection Rule.",
        "displayName": "Workspace Resource Id",
        "strongType": "omsWorkspace"
      }
    },
    "workspaceRegion": {
      "type": "String",
      "metadata": {
        "description": "Region of the Log Analytics workspace destination for the Data Collection Rule.",
        "displayName": "Workspace region",
        "strongType": "location"
      }
    }
  },
  "policyDefinitions": [
    {
      "policyDefinitionReferenceId": "defenderForSqlArcAma",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/3592ff98-9787-443a-af59-4505d0fe0786",
      "parameters": {
        "effect": {
          "value": "[parameters('effect')]"
        }
      },
      "groupNames": []
    },
    {
      "policyDefinitionReferenceId": "defenderForSqlArcMdsql",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/65503269-6a54-4553-8a28-0065a8e6d929",
      "parameters": {
        "effect": {
          "value": "[parameters('effect')]"
        }
      },
      "groupNames": []
    },
    {
      "policyDefinitionReferenceId": "defenderForSqlArcMdsqlDcr",
      "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/alz/providers/Microsoft.Authorization/policyDefinitions/Deploy-MDFC-Arc-Sql-DefenderSQL-DCR",
      "parameters": {
        "dcrId": {
          "value": "[parameters('dcrId')]"
        },
        "dcrName": {
          "value": "[parameters('dcrName')]"
        },
        "dcrResourceGroup": {
          "value": "[parameters('dcrResourceGroup')]"
        },
        "effect": {
          "value": "[parameters('effect')]"
        },
        "enableCollectionOfSqlQueriesForSecurityResearch": {
          "value": "[parameters('enableCollectionOfSqlQueriesForSecurityResearch')]"
        },
        "userWorkspaceResourceId": {
          "value": "[parameters('userWorkspaceResourceId')]"
        },
        "workspaceRegion": {
          "value": "[parameters('workspaceRegion')]"
        }
      },
      "groupNames": []
    },
    {
      "policyDefinitionReferenceId": "defenderForSqlArcDcrAssociation",
      "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/alz/providers/Microsoft.Authorization/policyDefinitions/Deploy-MDFC-Arc-SQL-DCR-Association",
      "parameters": {
        "dcrId": {
          "value": "[parameters('dcrId')]"
        },
        "dcrName": {
          "value": "[parameters('dcrName')]"
        },
        "dcrResourceGroup": {
          "value": "[parameters('dcrResourceGroup')]"
        },
        "effect": {
          "value": "[parameters('effect')]"
        },
        "workspaceRegion": {
          "value": "[parameters('workspaceRegion')]"
        }
      },
      "groupNames": []
    },
    {
      "policyDefinitionReferenceId": "defenderForSqlAma",
      "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/alz/providers/Microsoft.Authorization/policyDefinitions/Deploy-MDFC-SQL-AMA",
      "parameters": {
        "effect": {
          "value": "[parameters('effect')]"
        },
        "identityResourceGroup": {
          "value": "[parameters('identityResourceGroup')]"
        },
        "userAssignedIdentityName": {
          "value": "[parameters('userAssignedIdentityName')]"
        }
      },
      "groupNames": []
    },
    {
      "policyDefinitionReferenceId": "defenderForSqlMdsql",
      "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/alz/providers/Microsoft.Authorization/policyDefinitions/Deploy-MDFC-SQL-DefenderSQL",
      "parameters": {
        "dcrId": {
          "value": "[parameters('dcrId')]"
        },
        "dcrName": {
          "value": "[parameters('dcrName')]"
        },
        "dcrResourceGroup": {
          "value": "[parameters('dcrResourceGroup')]"
        },
        "effect": {
          "value": "[parameters('effect')]"
        },
        "workspaceRegion": {
          "value": "[parameters('workspaceRegion')]"
        }
      },
      "groupNames": []
    },
    {
      "policyDefinitionReferenceId": "defenderForSqlMdsqlDcr",
      "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/alz/providers/Microsoft.Authorization/policyDefinitions/Deploy-MDFC-SQL-DefenderSQL-DCR",
      "parameters": {
        "dcrId": {
          "value": "[parameters('dcrId')]"
        },
        "dcrName": {
          "value": "[parameters('dcrName')]"
        },
        "dcrResourceGroup": {
          "value": "[parameters('dcrResourceGroup')]"
        },
        "effect": {
          "value": "Disabled"
        },
        "enableCollectionOfSqlQueriesForSecurityResearch": {
          "value": "[parameters('enableCollectionOfSqlQueriesForSecurityResearch')]"
        },
        "userWorkspaceResourceId": {
          "value": "[parameters('userWorkspaceResourceId')]"
        },
        "workspaceRegion": {
          "value": "[parameters('workspaceRegion')]"
        }
      },
      "groupNames": []
    }
  ],
  "policyDefinitionGroups": []
}
