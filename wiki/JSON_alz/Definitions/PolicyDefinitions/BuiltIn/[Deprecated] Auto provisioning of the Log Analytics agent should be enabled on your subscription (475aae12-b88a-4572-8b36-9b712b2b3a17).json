{
  "displayName": "[Deprecated]: Auto provisioning of the Log Analytics agent should be enabled on your subscription",
  "policyType": "BuiltIn",
  "mode": "All",
  "description": "Azure Security Center collects VM data using the Log Analytics agent for security monitoring. Enable auto provisioning for automatic deployment. This policy is deprecated due to the Azure Monitoring agent deprecation. Learn more at aka.ms/policydefdeprecation.",
  "metadata": {
    "version": "1.1.0-deprecated",
    "category": "Security Center",
    "deprecated": true
  },
  "parameters": {
    "effect": {
      "type": "String",
      "metadata": {
        "displayName": "Effect",
        "description": "Enable or disable the execution of the policy"
      },
      "allowedValues": [
        "AuditIfNotExists",
        "Disabled"
      ],
      "defaultValue": "Disabled"
    }
  },
  "policyRule": {
    "if": {
      "field": "type",
      "equals": "Microsoft.Resources/subscriptions"
    },
    "then": {
      "effect": "[parameters('effect')]",
      "details": {
        "type": "Microsoft.Security/autoProvisioningSettings",
        "existenceCondition": {
          "field": "Microsoft.Security/autoProvisioningSettings/autoProvision",
          "equals": "On"
        }
      }
    }
  }
}
